<!-- Citation for the following function: -->
<!-- Date: 03/07/2025  (Update to the date you copied/used it) -->
<!-- Copied from /OR/ Adapted from /OR/ Based on: -->
<!-- Source URL: https://github.com/osu-cs340-ecampus/flask-starter-app -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriSphere: Exercises</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>

<body>
    <header>
        <h1>NutriSphere: Exercises</h1>
        <nav>
            <a href="{{ url_for('home') }}">üè† Home</a>
            <a href="{{ url_for('users') }}">üë§ Users</a>
            <a href="{{ url_for('daily_trackers') }}">üóìÔ∏è Daily Trackers</a>
            <a href="{{ url_for('food_entries') }}">üçΩÔ∏è Food Entries</a>
            <a href="{{ url_for('food_items') }}">ü•ó Food Items</a>
            <a href="{{ url_for('exercises') }}">üèãÔ∏è Exercises</a>
        </nav> 
    </header>

    <!-- Exercises List Section -->
    <main>
        <h2>Exercises</h2>
        <table border="1">
            <thead>
                <tr>
                    <th>Exercise ID</th>
                    <th>Name</th>
                    <th>Duration (min)</th>
                    <th>Calories Burned</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>Elliptical</td>
                    <td>30</td>
                    <td>250</td>
                    <td>
                        <button onclick="populateUpdateForm(1)">‚úèÔ∏è Edit</button>
                        <button onclick="deleteExercise(1, true)">‚ùå Delete</button>
                    </td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Hiking</td>
                    <td>120</td>
                    <td>600</td>
                    <td>
                        <button onclick="populateUpdateForm(2)">‚úèÔ∏è Edit</button>
                        <button onclick="deleteExercise(2, true)">‚ùå Delete</button>
                    </td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>Swimming</td>
                    <td>30</td>
                    <td>300</td>
                    <td>
                        <button onclick="populateUpdateForm(3)">‚úèÔ∏è Edit</button>
                        <button onclick="deleteExercise(3, true)">‚ùå Delete</button>
                    </td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>Pickleball</td>
                    <td>60</td>
                    <td>400</td>
                    <td>
                        <button onclick="populateUpdateForm(4)">‚úèÔ∏è Edit</button>
                        <button onclick="deleteExercise(4, true)">‚ùå Delete</button>
                    </td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>Weight Lifting</td>
                    <td>60</td>
                    <td>150</td>
                    <td>
                        <button onclick="populateUpdateForm(5)">‚úèÔ∏è Edit</button>
                        <button onclick="deleteExercise(5, true)">‚ùå Delete</button>
                    </td>
                </tr>

                <!-- Database Exercises -->
                {% for exercise in exercises %}
                <tr id="exerciseRow-{{ exercise.exerciseID }}">
                    <td>{{ exercise.exerciseID }}</td>
                    <td>{{ exercise.name }}</td>
                    <td>{{ exercise.exerciseMinutes }}</td>
                    <td>{{ exercise.caloriesBurned }}</td>
                    <td>
                        <button onclick="populateUpdateForm({{ exercise.exerciseID }})">‚úèÔ∏è Edit</button>
                        <button onclick="deleteExercise({{ exercise.exerciseID }}, false)">‚ùå Delete</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </main>

    <!-- Add Exercise Form -->
    <section>
        <h2>Add a New Exercise</h2>
        <form action="{{ url_for('add_exercise') }}" method="POST">
            <label>Name</label>
            <input type="text" name="name" required>
            <label>Duration (in min)</label>
            <input type="number" name="exerciseMinutes" required>
            <label>Calories Burned</label>
            <input type="number" name="caloriesBurned" required>
            <button type="submit">‚ûï Add Exercise</button>
        </form>
    </section>

    <!-- Update Exercise Form -->
    <section>
        <h2>Update an Exercise</h2>
        <form action="{{ url_for('update_exercise', exercise_id=exercises[0].exerciseID if exercises else 0) }}" method="POST">
            <label>Name</label>
            <input type="text" id="updateName" name="name" required>
            <label>Duration (min)</label>
            <input type="number" id="updateDuration" name="exerciseMinutes" required>
            <label>Calories Burned</label>
            <input type="number" id="updateCalories" name="caloriesBurned" required>
            <button type="submit">Save</button>
        </form>
    </section>

    <script>
        // Load database exercises properly using Flask's tojson filter
        const dbExercises = {{ exercises | tojson }};
        console.log(dbExercises);  // See if it renders as an array of objects
        
        // Hardcoded recommended exercises
        const hardcodedExercises = {
            "1": { name: "Elliptical", duration: 30, calories: 250 },
            "2": { name: "Hiking", duration: 120, calories: 600 },
            "3": { name: "Swimming", duration: 30, calories: 300 },
            "4": { name: "Pickleball", duration: 60, calories: 400 },
            "5": { name: "Weight Lifting", duration: 60, calories: 150 }
        };
    
        // Combine hardcoded and database exercises into one object (optional)
        const allExercises = { ...hardcodedExercises };
        dbExercises.forEach(ex => {
            allExercises[ex.exerciseID] = ex;
        });

        // Populate Update Form
        function populateUpdateForm(exerciseID) {
            const exercise = allExercises[exerciseID];
            if (exercise) {
                document.getElementById('updateName').value = exercise.name;
                document.getElementById('updateDuration').value = exercise.exerciseMinutes;
                document.getElementById('updateCalories').value = exercise.caloriesBurned;
                document.getElementById('updateExerciseForm').action = `/update_exercise/${exerciseID}`;
            }
        }

        // Populate Delete Form when selected from dropdown
        function populateDeleteForm(exerciseID) {
            const exercise = exercises[exerciseID];
            if (exercise) {
                document.getElementById('deleteExerciseID').value = exerciseID;
                document.getElementById('deleteExerciseName').value = exercise.name;
                document.getElementById('deleteExerciseDuration').value = exercise.exerciseMinutes;
                document.getElementById('deleteExerciseCalories').value = exercise.caloriesBurned;
            } else {
                // Clear if invalid selection
                document.getElementById('deleteExerciseID').value = '';
                document.getElementById('deleteExerciseName').value = '';
                document.getElementById('deleteExerciseDuration').value = '';
                document.getElementById('deleteExerciseCalories').value = '';
            }
        }

        // Confirm Delete (Dropdown Form)
        function confirmDelete() {
            const selectedID = document.getElementById('deleteExerciseID').value;
            if (!selectedID || selectedID < 0) {  // Prevent deleting hardcoded (negative ID) exercises
                alert('Please select a valid user exercise to delete.');
                return false;
            }

            if (confirm('Are you sure you want to delete this exercise?')) {
                fetch(`/delete_exercise/${selectedID}`, { method: 'POST' })
                    .then(response => {
                        if (response.ok) {
                            document.getElementById(`exerciseRow-${selectedID}`).remove();
                            alert('Exercise deleted!');
                            document.getElementById('deleteExerciseForm').reset();
                        } else {
                            alert('Failed to delete exercise.');
                        }
                    });
            }
            return false;  // Prevent default form submit
        }

        // Inline Delete (Button-based)
        function deleteExercise(exerciseID) {
            if (exerciseID < 0) {  // Prevent deleting hardcoded recommended exercises
                alert('Cannot delete recommended exercises.');
                return;
            }

            if (confirm('Are you sure you want to delete this exercise?')) {
                fetch(`/delete_exercise/${exerciseID}`, { method: 'POST' })
                    .then(response => {
                        if (response.ok) {
                            document.getElementById(`exerciseRow-${exerciseID}`).remove();
                            alert('Exercise deleted!');
                        } else {
                            alert('Failed to delete exercise.');
                        }
                    });
            }
        }
    </script>
</body>

</html>